\documentclass[12pt, oneside]{article} 
% \documentclass{article} 
\usepackage{amsmath, amsthm, amssymb, calrsfs, wasysym, verbatim, bbm, color, graphics, geometry}
\usepackage{fancyvrb} % for "\Verb" macro
\usepackage[toc,page]{appendix}
\usepackage[pdftex]{graphicx}
\usepackage{float}
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,      
    urlcolor=cyan,
}
 
\urlstyle{same}

\geometry{tmargin=1.25in, bmargin=1.25in, lmargin=1.00in, rmargin = 1.00in}  

\newcommand{\R}{\mathbb{R}}
\newcommand{\C}{\mathbb{C}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Cdot}{\boldsymbol{\cdot}}

\usepackage{listings}
\usepackage{color} %red, green, blue, yellow, cyan, magenta, black, white
\definecolor{mygreen}{RGB}{28,172,0} % color values Red, Green, Blue
\definecolor{mylilas}{RGB}{170,55,241}

\title{CIS580 PSet 3}
\author{Sheil Sarda}
\date{02.24.2021}

\begin{document}
\lstset{language=Matlab,%
    %basicstyle=\color{red},
    breaklines=true,%
    morekeywords={matlab2tikz},
    keywordstyle=\color{blue},%
    morekeywords=[2]{1}, keywordstyle=[2]{\color{black}},
    identifierstyle=\color{black},%
    stringstyle=\color{mylilas},
    commentstyle=\color{mygreen},%
    showstringspaces=false,%without this there will be a symbol in the places where there is a space
    numbers=left,%
    numberstyle={\tiny \color{black}},% size of the numbers
    numbersep=9pt, % this defines how far the numbers are from the text
    emph=[1]{for,end,break},emphstyle=[1]\color{red}, %some words to emphasise
    %emph=[2]{word1,word2}, emphstyle=[2]{style},    
}

\begin{titlepage}
    \begin{flushleft}
        \vspace*{1cm}
        \Huge
        \textbf{CIS580 Problem Set 3\\ }
        \vspace*{0.5cm}
        \normalsize
        Sheil Sarda \verb|<sheils@seas.upenn.edu>| \\
        CIS580 Spring 2021
        \tableofcontents
    \end{flushleft}
\end{titlepage}

\section{Transformation to map facade to rectangle}

\begin{align*}
    W' \sim P
    \begin{bmatrix} 1   \\ 0   \\ 0   \end{bmatrix} \implies 
    \alpha W' = P
    \begin{bmatrix} 1   \\ 0   \\ 0   \end{bmatrix}  &= T_1 \\ \\
    X' \sim P
    \begin{bmatrix} 0   \\ 1   \\ 0   \end{bmatrix} \implies 
    \beta X' = P
    \begin{bmatrix} 0   \\ 1   \\ 0   \end{bmatrix}  &= T_2 \\ \\
    Y' \sim P
    \begin{bmatrix} 0   \\ 0   \\ 1   \end{bmatrix} \implies 
    \gamma Y' = P
    \begin{bmatrix} 0   \\ 0   \\ 1   \end{bmatrix}   &= T_3 \\ \\
    Z' \sim P
    \begin{bmatrix} 1   \\ 1    \\ 1   \end{bmatrix} \implies 
    \delta Z' = P
    \begin{bmatrix} 1   \\ 1   \\ 1 \end{bmatrix}   &= T_1 + T_2 + T_3
\end{align*}
    
    Combining the above equations:
\begin{align*}
    \delta  \begin{bmatrix} 1   \\ 1   \\ 1   \end{bmatrix}  &= 
    \alpha \begin{bmatrix} -b   \\ 0   \\   1   \end{bmatrix} +
    \beta \begin{bmatrix} 0   \\ h   \\   1   \end{bmatrix} + 
    \gamma  \begin{bmatrix} 0  \\ 0 \\ 1  \end{bmatrix} 
\end{align*} 
  
    We can infer that $\delta = 1$, and simplify the system of equations to:
    
\begin{align*}
    \delta  \begin{bmatrix} 1   \\ 1   \\ 1   \end{bmatrix}  &= 
    \alpha \begin{bmatrix} -b   \\ 0   \\   1   \end{bmatrix} +
    \beta \begin{bmatrix} 0   \\ h   \\   1   \end{bmatrix} + 
    \gamma  \begin{bmatrix} 0  \\ 0 \\ 1  \end{bmatrix}
\end{align*} 
  
\begin{align*}
  \begin{bmatrix} \alpha & \beta & \gamma \end{bmatrix}  
  &= \left(\begin{bmatrix}
  -b    & 0     & 0   \\
  0     & h     & 0 \\
  1     & 1     & 1
  \end{bmatrix} \right) ^{-1}
  \begin{bmatrix}
  1  \\
  1   \\
  1  
  \end{bmatrix}
\end{align*} 
  
  Solving for the inverse of the coefficient matrix, we obtain:
  \begin{align*}
  \begin{bmatrix}
  \alpha \\
  \beta \\
  \gamma
  \end{bmatrix} = 
  \begin{bmatrix}
  -1 / b    \\
  1 / h   \\
  1/b - 1/h + 1
  \end{bmatrix} 
  \end{align*}
    
  From this, we obtain the transformation $P$ by multiplying $\alpha, \beta$ and 
  $\gamma$ into the above equation:
  
\begin{align*}
    T^{-1} &=
    \alpha \begin{bmatrix} -b   \\ 0   \\   1   \end{bmatrix} +
    \beta \begin{bmatrix} 0   \\ h   \\   1   \end{bmatrix} + 
    \gamma  \begin{bmatrix} 0  \\ 0 \\ 1  \end{bmatrix}  \times
    \begin{bmatrix} 1  \\ 1 \\ 1  \end{bmatrix}         \\ \\
    &=   \frac{-1}{b} \begin{bmatrix} -b   \\ 0   \\   1   \end{bmatrix} +
    \frac{1}{h} \begin{bmatrix} 0   \\ h   \\   1   \end{bmatrix} + 
    \left(\frac{1}{b} - \frac{1}{h} + 1 \right) 
    \begin{bmatrix} 0  \\ 0 \\ 1  \end{bmatrix}  \times
    \begin{bmatrix} 1  \\ 1 \\ 1  \end{bmatrix}  \\ \\
    &= \begin{bmatrix}
      1             &  0   & 0 \\
      0             &  1   & 0 \\
      \frac{-1}{b}  &  \frac{1}{h}  & \frac{1}{b} - \frac{1}{h} + 1
      \end{bmatrix} \times 
      \begin{bmatrix} 1 \\ 1 \\ 1  \end{bmatrix} \\
\end{align*} 
    
Taking the inverse of the above transformation matrix, we obtain the matrix $T$:

\begin{align*}
    T &=
    \begin{bmatrix}
      1             &  0   & 0 \\
      0             &  1   & 0 \\
      \frac{h}{h - b + bh}      &  
      \frac{-b}{h - b + bh}     & 
      \frac{bh}{h - b + bh}
      \end{bmatrix}
\end{align*}

\clearpage
\section{Compute distances of patrol car and bridge}

\subsection{Distance from bridge to junction}

Known quantities:

\begin{table}[H]
\centering
\begin{tabular}{|c|l|}
\hline
\textbf{Segment} & \textbf{Value}  \\ \hline
$XA$      & 4 cm     \\ \hline
$AB$      & 4 cm     \\ \hline
$BY$      & 2 cm     \\ \hline 
$YC$      & 1 cm     \\ \hline
\end{tabular}
\end{table}

Using cross-ratios of the above quantities, we obtain:
\begin{align*}
    \frac{AY/AC}{BY/BC}  &= \frac{6/7}{2/3} \\ 
    \frac{1-CY}{(0.5-CY)/0.5}  &= \frac{6/7}{2/3} &\text{Given  
                                junction location and map signs}  \\ 
    \frac{1-CY}{(0.5-CY)/0.5}  &= \frac{6/7}{2/3} \\ 
    CY  &= \frac{9}{7} \cdot (2CY - 1) + 1  \\ 
    CY  &= \frac{18 CY}{7} - \frac{2}{7} \\
    \implies CY &=  \frac{2}{11} = 0.182 km 
\end{align*}

Using the above information, we can also compute $YB = 0.5 - CY = \frac{7}{22}$.

\subsection{Distance from patrol car to junction}

Using cross-ratios, we obtain:
\begin{align*}
    \frac{XB/XY}{AB/AY}  &= \frac{8/10}{4/6} \\ 
    \frac{(0.5 + XA)/(BY + 0.5 + XA)}{0.5/(BY + 0.5)}  &= \frac{8/10}{4/6}  \\ 
    \frac{(18/22)(0.5 + XA)}{0.5(18/22 + XA)}  &= \frac{8/10}{4/6}  \\
    \frac{(9/22) + (18XA/22)}{(9/22 + 0.5XA)}  &= \frac{8/10}{4/6}  \\
    (4/6)((9/22) + (18XA/22))  &= (9/22 + 0.5XA)(8/10)  \\
    (3/11) + (6XA/11)  &= 36/110 + (2XA/5)  \\
    8XA/55  &= 6/110   \\
    XA  &= (6 * 55) / (110 * 8) = 3/8 = 0.375 km \\
    \implies XC &= 1 + \frac{3}{8} = 1.375 km 
\end{align*}

\clearpage
\section{Compute distances from the image}

\subsection{Distance $BC$}

Using cross-ratios, we obtain:
$$\frac{A_wC_w/A_wD_w}{B_wC_w/B_wD_w}  = \frac{8/12}{4/8} $$

We also know, 
$$\frac{AC/AD}{BC/BD}  = \frac{8/12}{4/8} = 
\frac{(3 + BC)/(5 + BC)}{BC/(2 + BC)}$$

Simplifying the above expression to solve for $BC$, we obtain:
\begin{align*}
    \frac{8/12}{4/8} &=  \frac{(3 + BC)/(5 + BC)}{BC/(2 + BC)} \\
    \frac{4}{3} &=  \frac{(3 + BC)(2 + BC)}{BC(5 + BC)} 
\end{align*}

Solving the above quadratic equation, we obtain $BC = 2.42$ units.

\subsection{Distance $DV$}

Using a similar technique as above, we obtain:
$$\frac{B_wD_w/B_wV_w}{C_wD_w/C_wV_w} = \frac{B_wD_w}{C_wD_w}  
= \frac{8}{4} $$

We also know, 
$$\frac{BD/BV}{CD/CV}  = 2 = 
\frac{(2BC)/(2BC+DV)}{2/(2 + DV)}$$

Simplifying the above expression to solve for $BC$, we obtain:
\begin{align*}
    2 &= \frac{(2BC)/(2BC+DV)}{2/(2 + DV)}\\
    2 &= \frac{4.424 \cdot (2 + DV)}{2 \cdot (4.424 + DV)}
\end{align*}

Solving the above equation for $DV$, we obtain $DV = 20.87$ units.

\clearpage
\section{Different perspectives in a tennis match}
\subsection{Why is the perspective different}

\begin{figure}[H]
    \includegraphics[width=0.475\textwidth]{imgs/tennis1_original}
    \hfill
    \includegraphics[width=0.475\textwidth]{imgs/tennis2_original}
  \end{figure}

The perspective of the two images above are different because the camera for the 
left image is located much closer to the court than the right image due to the
construction of the stadium.

Consequently, the image on the right is more zoomed-in to focus-in on the court
whereas the image on the left uses a larger Field of View lens to get the entire
court into focus from the shorter distance.

\subsection{Find vanishing points using cross-ratios}

\begin{figure}[H]
  \includegraphics[width=0.475\textwidth]{imgs/tennis1}
  \hfill
  \includegraphics[width=0.475\textwidth]{imgs/tennis1_excel}
\end{figure}

\begin{figure}[H]
  \includegraphics[width=0.475\textwidth]{imgs/tennis2}
  \hfill
  \includegraphics[width=0.475\textwidth]{imgs/tennis2_excel}
\end{figure}

Known quantities:
\begin{table}[H]
\centering
\begin{tabular}{|c|c|l|}
\hline
\multicolumn{1}{|l|}{\textbf{Units}} & \textbf{Segment} & \textbf{Value}  \\ \hline
Image & $AD$      & $\sqrt{1092^2 + 16^2} = 1092$ pixels     \\ \hline
Image & $BC$      & $\sqrt{364^2 + 6^2} = 364$ pixels       \\ \hline
Image & $AB$      & $\sqrt{730^2 + 384^2} = 825$ pixels     \\ \hline
Image & $CD$      & $\sqrt{344^2 + 740^2} = 816$ pixels     \\ \hline
Image & $M_1 M_2$ & $\sqrt{540^2 + 14^2} = 540$ pixels     \\ \hline
Image & $A'D'$      & $\sqrt{1260^2 + 6^2} = 1260$ pixels     \\ \hline
Image & $B'C'$      & $\sqrt{600^2 + 0^2} = 600$ pixels       \\ \hline
Image & $A'B'$      & $\sqrt{324^2 + 754^2} = 821$ pixels     \\ \hline
Image & $C'D'$      & $\sqrt{336^2 + 748^2} = 820$ pixels     \\ \hline
Image & $M_1' M_2'$ & $\sqrt{804^2 + 0^2} = 804$ pixels     \\ \hline
World & $AD, A'D'$      & 27 feet     \\ \hline
World & $BC, B'C$       & 27 feet     \\ \hline
World & $AB, A'B'$      & 78 feet     \\ \hline
World & $CD, C'D'$      & 78 feet     \\ \hline
\end{tabular}
\end{table}

\textbf{Vanishing Point for Image 1}
\begin{align*}
  \frac{DC/DV}{{M_1}C/M_1V} &= \frac{C_wD_w/D_wV_w}{{M_1}_wC_w/{M_1}_wV_w} \\
  \frac{816/DV}{195/M_1V}                 &= 2 \cdot {M_1}_wV_w/D_wV_w \\
  \frac{816}{195}\cdot \frac{M_1V}{DV}    &= 2 \cdot {M_1}_wV_w/D_wV_w \\
  \frac{195 + CV}{816 + CV}   &= \frac{195}{816}\cdot 2 \cdot 1 \\
  (195 + CV) \cdot 816   &= 390 \cdot (816 + CV) \\
  CV \cdot (816 - 390)   &= 816 \cdot (390 - 195)\\
  CV  &= \frac{816 \cdot 195} {426}\\
  CV  &= 374\\
\end{align*}

Given the slope of the line and the distance $CV$, we can compute $V$ as follows:
\begin{align}
    m &= \frac{548-724}{832-748} = \frac{724-V_y}{748 - V_x}  \\
    374 &= \sqrt{(724-V_y)^2 + (748 - V_x)^2}
\end{align}

Solving the above system of equations using Mathematica, we obtain the possible
vanishing points as:
\begin{align*}
    {V_x\to 909.093,V_y\to 386.472} \\
    {V_x\to 586.907,V_y\to 1061.53} 
\end{align*}



\textbf{Vanishing Point for Image 2}
\begin{align*}
  \frac{D'C'/D'V'}{{M_1}'C'/{M_1}'V'} &= \frac{{C_w}'{D_w}'/{D_w}'{V_w}'}
                                        {{{M_1}_w}'{C_w}'/{{M_1}_w}'{V_w}'} \\
  \frac{820/DV}{257/M_1V}                 &= 2 \cdot {M_1}_wV_w/D_wV_w \\
  \frac{820}{257}\cdot \frac{M_1V}{DV}    &= 2 \cdot {M_1}_wV_w/D_wV_w \\
  \frac{257 + CV}{820 + CV}   &= \frac{257}{820}\cdot 2 \cdot 1 \\
  (257 + CV) \cdot 820   &= 514 \cdot (820 + CV) \\
  CV \cdot (820 - 514)   &= 820 \cdot (514 - 257)\\
  CV  &= \frac{820 \cdot 257} {306}\\
  CV  &= 689\\
\end{align*}

Given the slope of the line and the distance $CV$, we can compute $V$ as follows:
\begin{align}
    m &= \frac{518-754}{1026-924} = \frac{754-V_y}{924 - V_x}  \\
    689 &= \sqrt{(754-V_y)^2 + (924 - V_x)^2}
\end{align}

Solving the above system of equations using Mathematica, we obtain the possible
vanishing points as:
\begin{align*}
    {V_x\to 1197.35,V_y\to 121.544} \\
    {V_x\to 650.65,V_y\to 1386.46} 
\end{align*}

\subsection{Find vanishing points for court baselines}

\subsubsection*{Image 1 Horizontal Vanishing Point}

\begin{align*}
L_1 &=    \begin{bmatrix}
            384 \\
            730 \\
            1
        \end{bmatrix} \times 
        \begin{bmatrix}
            748 \\
            724 \\
            1
        \end{bmatrix}  = 
        \begin{bmatrix}
            6  \\
            364 \\
            -268024 
        \end{bmatrix}                                                   
\end{align*}

\begin{align*}
L_2 &=    \begin{bmatrix}
            0 \\
            0 \\
            1
        \end{bmatrix} \times 
        \begin{bmatrix}
            1092 \\
            -16 \\
            1
        \end{bmatrix}  = 
        \begin{bmatrix}
            16  \\
            1092 \\
            0 
        \end{bmatrix}                                                   
\end{align*}

Now, computing $L_1 \times L_2$ to obtain the vanishing point:
\begin{align*}
    \begin{bmatrix}
        6  \\
        364 \\
        -268024 
    \end{bmatrix}     \times 
    \begin{bmatrix}
        16  \\
        1092 \\
        0 
    \end{bmatrix}    = 
    \begin{bmatrix}
        402036  \\
        -5891 \\
        1 
    \end{bmatrix}
\end{align*}


\subsubsection*{Image 2 Horizontal Vanishing Point}

\begin{align*}
    L_1 &=    \begin{bmatrix}
                324 \\
                754 \\
                1
            \end{bmatrix} \times 
            \begin{bmatrix}
                924 \\
                754 \\
                1
            \end{bmatrix}  = 
            \begin{bmatrix}
                0  \\
                600 \\
                -452400 
            \end{bmatrix}                                                   
    \end{align*}
    
    \begin{align*}
    L_2 &=    \begin{bmatrix}
                0 \\
                0 \\
                1
            \end{bmatrix} \times 
            \begin{bmatrix}
                1260 \\
                6 \\
                1
            \end{bmatrix}  = 
            \begin{bmatrix}
                -6  \\
                1260 \\
                0 
            \end{bmatrix}                                                   
    \end{align*}
    
    Now, computing $L_1 \times L_2$ to obtain the vanishing point:
    \begin{align*}
        \begin{bmatrix}
            0  \\
            600 \\
            -452400 
        \end{bmatrix}    \times 
        \begin{bmatrix}
            -6  \\
            1260 \\
            0 
        \end{bmatrix}    = 
        \begin{bmatrix}
            158340  \\
            754 \\
            1 
        \end{bmatrix}
    \end{align*}
    
\subsubsection*{Finding the homography that maps tennis court to 
                image plane}

\subsubsection*{Image 1} 

\begin{align*}
  W' \sim P
   \begin{bmatrix}
  0   \\
  0   \\
  1  
  \end{bmatrix} \implies 
  \alpha W' = P
   \begin{bmatrix}
  0   \\
  0   \\
  1  
  \end{bmatrix}  &= P_3 \\
  X' \sim P
   \begin{bmatrix}
  0   \\
  1   \\
  0  
  \end{bmatrix} \implies 
  \beta X' = P
   \begin{bmatrix}
  0   \\
  1   \\
  0  
  \end{bmatrix}  &= P_2 \\
  Y' \sim P
   \begin{bmatrix}
  1   \\
  0   \\
  0  
  \end{bmatrix} \implies 
  \gamma Y' = P
   \begin{bmatrix}
  1   \\
  0   \\
  0  
  \end{bmatrix}   &= P_1 \\
  Z' \sim P
   \begin{bmatrix}
  27   \\
  78   \\
  1  
  \end{bmatrix} \implies 
  \delta Z' = P
   \begin{bmatrix}
  27   \\
  78   \\
  1  
  \end{bmatrix}   &= 27 P_1 + 78 P_2 + P_3
  \end{align*}
  
  Combining the above equations:
  \begin{align*}
  \delta  \begin{bmatrix} 748   \\ 724   \\ 1   \end{bmatrix}  &= 
  27 \gamma  \begin{bmatrix} 402036  \\ -5891 \\ 1  \end{bmatrix} + 
  78\beta \begin{bmatrix} 576   \\ 1095   \\   1   \end{bmatrix} + 
  \alpha \begin{bmatrix} 0   \\ 0   \\   1   \end{bmatrix} 
  \end{align*} 

  We can infer that $\alpha = 1$, and simplify the system of equations to:
  
\begin{align*}
\alpha  \begin{bmatrix} 0  \\ 0   \\ 1   \end{bmatrix} &= 
\delta  \begin{bmatrix} 748   \\ 724   \\  1  \end{bmatrix} -
78\beta \begin{bmatrix} 576   \\ 1095   \\ 1   \end{bmatrix} 
- 27 \gamma  \begin{bmatrix} 402036  \\ -5891 \\ 1  \end{bmatrix} \\ \\ 
\alpha  \begin{bmatrix} 0  \\ 0   \\ 1   \end{bmatrix} &= 
\delta  \begin{bmatrix} 748   \\ 724   \\  1  \end{bmatrix} +
\beta \begin{bmatrix} -44928  \\ -85410   \\ -78   \end{bmatrix} +
\gamma  \begin{bmatrix} -10854972  \\ 159057 \\ -27 \end{bmatrix} 
\end{align*} 

\begin{align*}
\begin{bmatrix} \delta & \beta & \gamma \end{bmatrix}  
&= \left(\begin{bmatrix}
748 & -44928 & -10854972   \\
724 & -85410 & 159057 \\
1   & -78     & -27	
\end{bmatrix} \right) ^{-1}
\begin{bmatrix}
0  \\
0   \\
1  
\end{bmatrix}
\end{align*} 

Solving for the inverse of the coefficient matrix, we obtain:
\begin{align*}
\begin{bmatrix}
\delta \\
\beta \\
\gamma
\end{bmatrix} = 
\begin{bmatrix}
3.0027    \\
0.0256   \\
0.0001
\end{bmatrix} 
\end{align*}
  
From this, we obtain the transformation $P$ by multiplying $\alpha, \beta$ and 
$\gamma$ into the above equation:

\begin{align*}
    \begin{bmatrix} 748   \\ 724   \\ 1   \end{bmatrix}  &= 
    \gamma  \begin{bmatrix} 402036  \\ -5891 \\ 1  \end{bmatrix} + 
    \beta \begin{bmatrix} 576   \\ 1095   \\   1   \end{bmatrix} + 
    \alpha \begin{bmatrix} 0   \\ 0   \\   1   \end{bmatrix} \times 
    \begin{bmatrix} 27 \\ 78 \\ 1  \end{bmatrix} \\ \\
    &= \begin{bmatrix}
    13.4944     &  4.9186   & 0 \\
    -0.1977     &  9.3505   & 0 \\
    0           & 0.0085  & 0.3300
    \end{bmatrix} \times 
    \begin{bmatrix} 27 \\ 78 \\ 1  \end{bmatrix} \\
\end{align*} 



\subsubsection*{Image 2} 

\begin{align*}
    W' \sim P
     \begin{bmatrix}
    0   \\
    0   \\
    1  
    \end{bmatrix} \implies 
    \alpha W' = P
     \begin{bmatrix}
    0   \\
    0   \\
    1  
    \end{bmatrix}  &= P_3 \\
    X' \sim P
     \begin{bmatrix}
    0   \\
    1   \\
    0  
    \end{bmatrix} \implies 
    \beta X' = P
     \begin{bmatrix}
    0   \\
    1   \\
    0  
    \end{bmatrix}  &= P_2 \\
    Y' \sim P
     \begin{bmatrix}
    1   \\
    0   \\
    0  
    \end{bmatrix} \implies 
    \gamma Y' = P
     \begin{bmatrix}
    1   \\
    0   \\
    0  
    \end{bmatrix}   &= P_1 \\
    Z' \sim P
     \begin{bmatrix}
    27   \\
    78   \\
    1  
    \end{bmatrix} \implies 
    \delta Z' = P
     \begin{bmatrix}
    27   \\
    78   \\
    1  
    \end{bmatrix}   &= 27 P_1 + 78 P_2 + P_3
    \end{align*}
    
    Combining the above equations:
    \begin{align*}
    \delta  \begin{bmatrix} 924   \\ 754   \\ 1   \end{bmatrix}  &= 
    27 \gamma  \begin{bmatrix} 158340  \\ 754 \\ 1  \end{bmatrix} + 
    78\beta \begin{bmatrix} 651   \\ 1386 \\   1   \end{bmatrix} + 
    \alpha \begin{bmatrix} 0   \\ 0   \\   1   \end{bmatrix} 
    \end{align*} 
  
    We can infer that $\alpha = 1$, and simplify the system of equations to:
    
  \begin{align*}
  \alpha  \begin{bmatrix} 0  \\ 0   \\ 1   \end{bmatrix} &= 
  \delta  \begin{bmatrix} 924   \\ 754   \\ 1   \end{bmatrix}  -
  78\beta \begin{bmatrix} 651   \\ 1386	\\   1   \end{bmatrix}
  - 27 \gamma  \begin{bmatrix} 158340  \\ 754 \\ 1  \end{bmatrix}\\ \\ 
  \alpha  \begin{bmatrix} 0  \\ 0   \\ 1   \end{bmatrix} &= 
  \delta  \begin{bmatrix} 924   \\ 754   \\ 1   \end{bmatrix}  +
  \beta \begin{bmatrix} -50778  \\ -108108   \\ -78   \end{bmatrix} +
  \gamma  \begin{bmatrix} -4275180  \\ -20358 \\ -27 \end{bmatrix} 
  \end{align*} 
  
  \begin{align*}
  \begin{bmatrix} \delta & \beta & \gamma \end{bmatrix}  
  &= \left(\begin{bmatrix}
    924 & -50778    & -4275180   \\
    754 & -108108     & -20358\\
    1   & -78       & -27
  \end{bmatrix} \right) ^{-1}
  \begin{bmatrix}
  0  \\
  0   \\
  1  
  \end{bmatrix}
  \end{align*} 
  
  Solving for the inverse of the coefficient matrix, we obtain:
  \begin{align*}
  \begin{bmatrix} \delta \\ \beta \\ \gamma \end{bmatrix} = 
  \begin{bmatrix} 2.2010    \\  0.0153   \\ 0.0003  \end{bmatrix} 
  \end{align*}
    
From this, we obtain the transformation $P$ by multiplying $\alpha, \beta$ 
  and $\gamma$ into the above equation:
  
\begin{align*}
    \begin{bmatrix} 924   \\ 754   \\ 1   \end{bmatrix}  &= 
    \gamma  \begin{bmatrix} 158340  \\ 754 \\ 1  \end{bmatrix} + 
    \beta \begin{bmatrix} 651   \\ 1386   \\   1   \end{bmatrix} + 
    \alpha \begin{bmatrix} 0   \\ 0   \\   1   \end{bmatrix} \times 
    \begin{bmatrix} 27 \\ 78 \\ 1  \end{bmatrix} \\ \\
      &= \begin{bmatrix}
      21.1528     &   4.5240  & 0 \\
      0.1007       &   9.6318   & 0 \\
      0.0001       &   0.0069 & 0.4543
      \end{bmatrix} \times 
      \begin{bmatrix} 27 \\ 78 \\ 1  \end{bmatrix} \\
  \end{align*} 

\subsection{Compute the focal length of each image}

\subsubsection*{Horizon of Image 1} 

We can compute the horizon by taking the cross-product of the horizontal and Vertical
vanishing points of this image, as computed in the previous parts.

\begin{align*}
h   &=  \begin{bmatrix} 402036  \\ -5891 \\ 1  \end{bmatrix} \times 
        \begin{bmatrix} 576   \\ 1095   \\   1   \end{bmatrix} \\ \\
    &=  \begin{bmatrix} -6986   \\ -401460   \\ 443622636   \end{bmatrix}  \\ \\   
\implies V_A  &=  \begin{bmatrix} 0   \\ 0   \\ 1   \end{bmatrix} \times  
        \begin{bmatrix} -6986   \\ -401460   \\ 443622636 \end{bmatrix} \\ \\
    &=  \begin{bmatrix} 401460   \\ -6986   \\ 0   \end{bmatrix} 
\end{align*}

From the previous part, we also know that the homography $H$ is as follows:
\begin{align*}
\begin{bmatrix}
    13.4944     &  4.9186   & 0 \\
    -0.1977     &  9.3505   & 0 \\
    0           & 0.0085  & 0.3300
\end{bmatrix}
\end{align*}

\begin{align*}
I_A &= \begin{bmatrix} 29793 \\ -117 \\ 3 \end{bmatrix}  \implies 
I_B = \begin{bmatrix} 117 \\ 29793 \\ 3 \end{bmatrix}  \\ \\
\implies  V_B &= \begin{bmatrix} 148120 \\ 278550 \\ 250 \end{bmatrix}  
\end{align*}

Determining the slope $m$ of the horizon line $h$: 
$$ -6986x -401460 y +  443622636 = 0  \implies m = \frac{-6986x}{401460} = -0.01740$$

This implies, the slope of a line perpendicular to $h$ must have slope $m = 
\frac{401460}{6986} = 57.4664$. Using the point-slope form, we determine that the line 
which is perpendicular to $h$ and goes through $V_B$ must have the form:

\begin{align*}
    y - {V_B}_y &= m (x - {V_B}_x)  \\
    y - \frac{278550}{250} &= 57.4664 (x - \frac{148120}{250}) 
\end{align*}

We know that the $y$ coordinate of the principal point must lie at the center 
of the image, which is located at $228$ pixels.

\begin{align*}
    228 - \frac{278550}{250} &= 57.4664 (x - \frac{148120}{250})  \\
    x &=  \frac{1}{ 57.4664}( 228 -  \frac{278550}{250}) + \frac{148120}{250}  \\
    x &=  577.06 \\
\end{align*}

Thus, the principal point $P$ is:
\begin{align*}
    P &= \begin{bmatrix}577.06 \\ 228 \\1 \end{bmatrix} 
\end{align*}


% [549, -331, 1]
% 19,640 pixels focal length
% I_A = H^-1(V_A)
% I_B = 

% x of I_A = y of I_B
% y of I_A = -x of I_B
% z of I_A is z of I_B

% H times I_B = V_B

% horizontal VP 
% negative reciprocal of slope
% use coordinates of V_B to get line

\subsubsection*{Horizon of Image 2} 

We can compute the horizon by taking the cross-product of the horizontal and Vertical
vanishing points of this image, as computed in the previous parts.

\begin{align*}
h   &=  \begin{bmatrix} 158340  \\ 754 \\ 1  \end{bmatrix} \times 
        \begin{bmatrix} 651   \\ 1386 \\   1   \end{bmatrix} 
    =  \begin{bmatrix} -632   \\ -157689   \\ 218968386   \end{bmatrix}  \\ \\   
\implies V_A  &=  \begin{bmatrix} 0   \\ 0   \\ 1   \end{bmatrix} \times
        \begin{bmatrix} -632   \\ -157689   \\ 218968386   \end{bmatrix} 
    =  \begin{bmatrix} 157689   \\ -632   \\ 0   \end{bmatrix} 
\end{align*}

From the previous part, we also know that the homography $H$ is as follows:
\begin{align*}
\begin{bmatrix}
    21.1528     &   4.5240  & 0 \\
    0.1007       &   9.6318   & 0 \\
    0.0001       &   0.0069 & 0.4543
\end{bmatrix}
\end{align*}

\begin{align*}
    I_A &= \begin{bmatrix} 7485 \\ -144 \\ 0.5 \end{bmatrix} \implies 
    I_B = \begin{bmatrix} 144 \\ 7485 \\ 0.5 \end{bmatrix}  \\ \\
    \implies  V_B &= \begin{bmatrix} 36908 \\ 72114 \\ 52 \end{bmatrix}  
\end{align*}

Determining the slope $m$ of the horizon line $h$: 
$$  -632x  -157689y +  218968386 = 0  \implies m = \frac{-632}{157689} = -0.0040$$

This implies, the slope of a line perpendicular to $h$ must have slope $m = 
\frac{157689}{632} = 249.5079$. Using the point-slope form, we determine that the line 
which is perpendicular to $h$ and goes through $V_B$ must have the form:

\begin{align*}
    y - {V_B}_y &= m (x - {V_B}_x)  \\
    y - \frac{72114}{52} &= 249.51 (x - \frac{36908}{52}) 
\end{align*}

We know that the $y$ coordinate of the principal point must lie at the center 
of the image, which is located at $368$ pixels.

\begin{align*}
    368 - \frac{72114}{52} &= 249.51 (x - \frac{36908}{52})  \\
    x &=  \frac{1}{ 249.51}( 368 - \frac{72114}{52}) + \frac{36908}{52}  \\
    x &=  705.69 \\
\end{align*}

Thus, the principal point $P$ is:
\begin{align*}
    P &= \begin{bmatrix} 705.69 \\ 368 \\1 \end{bmatrix} 
\end{align*}

\subsection{Compute the vanishing points using intersection of parallel lines}

\textbf{Image 1 Vertical Vanishing Point}

\begin{align*}
L_1 &=    \begin{bmatrix}
            748 \\
            724 \\
            1
        \end{bmatrix} \times 
        \begin{bmatrix}
            1092 \\
            -16 \\
            1
        \end{bmatrix}  = 
        \begin{bmatrix}
            724 + 16 \\
            1092 - 748 \\
            -16*748 - 724*1092
        \end{bmatrix} = 
        \begin{bmatrix}
            740  \\
            344 \\
            -802576 
        \end{bmatrix}                                                   
\end{align*}

\begin{align*}
L_2 &=    \begin{bmatrix}
            384 \\
            730 \\
            1
        \end{bmatrix} \times 
        \begin{bmatrix}
            0 \\
            0 \\
            1
        \end{bmatrix}  = 
        \begin{bmatrix}
            730  \\
            -384 \\
            0 
        \end{bmatrix}                                                   
\end{align*}

Now, computing $L_1 \times L_2$ to obtain the vanishing point:
\begin{align*}
    \begin{bmatrix}
        740  \\
        344 \\
        -802576 
    \end{bmatrix} \times 
    \begin{bmatrix}
        730  \\
        -384 \\
        0 
    \end{bmatrix}   = 
\begin{bmatrix}
    576  \\
    1095 \\
    1 
\end{bmatrix}
\end{align*}


\textbf{Image 2 Vertical Vanishing Point}

\begin{align*}
L_1 &=  
\begin{bmatrix} 924 \\ 754 \\ 1 \end{bmatrix} \times 
\begin{bmatrix} 1260 \\ 6 \\ 1 \end{bmatrix}  = 
\begin{bmatrix} 748  \\ 336 \\ -944496 \end{bmatrix}
\end{align*}

\begin{align*}
L_2 &=  
\begin{bmatrix} 324 \\ 754 \\ 1 \end{bmatrix} \times 
\begin{bmatrix} 0 \\ 0 \\ 1 \end{bmatrix}  = 
\begin{bmatrix} 754  \\ -324 \\ 0 \end{bmatrix}                                                   
\end{align*}

Now, computing $L_1 \times L_2$ to obtain the vanishing point:
\begin{align*}
    \begin{bmatrix} 748  \\ 336 \\ -944496 \end{bmatrix}
 \times 
 \begin{bmatrix} 754  \\ -324 \\ 0 \end{bmatrix}    = 
    \begin{bmatrix} 617  \\ 1437 \\ 1  \end{bmatrix}
\end{align*}

\clearpage
\section{Correct perspective of reflection painting}

I believe this painting is not perspectively correct, since the lines connecting
the points in the image, such as the stool or the girls lower body does not 
converge to the same vanishing point.

Hence, according to the linked article, this implies the image is not correct.

\begin{figure}[H]
    \includegraphics[width=0.90\textwidth]{imgs/girl_at_mirror}
  \end{figure}

\end{document}

